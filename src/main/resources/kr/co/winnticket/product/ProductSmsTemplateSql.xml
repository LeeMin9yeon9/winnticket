<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.winnticket.product.admin.mapper.ProductSmsTemplateMapper">
    <select id="selectByProductId" resultType="ProductSmsTemplateDto">
        SELECT
            template_code AS templateCode,
            title,
            content
        FROM SMS_TEMPLATE
        WHERE product_id = #{id}
    </select>

    <select id="selectDefaultTemplate" resultType="ProductSmsTemplateDto">
        SELECT template_code AS templateCode,
               title,
               content
        FROM SMS_TEMPLATE
        WHERE product_id IS NULL
        AND template_code = #{code}
    </select>

    <insert id="upsertTemplate">
        INSERT INTO SMS_TEMPLATE
            (product_id, template_code, title, content)
        VALUES (#{id}, #{code}, #{title}, #{content})
        ON CONFLICT (product_id, template_code)
        DO UPDATE SET
            title = EXCLUDED.title,
            content = EXCLUDED.content,
            updated_at = NOW()
    </insert>
</mapper>