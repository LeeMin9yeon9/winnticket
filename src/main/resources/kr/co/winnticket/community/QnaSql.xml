<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.winnticket.community.qna.mapper.QnaMapper">
    <!--
    - QNA 상태별 카운트 Select
    -->
    <select id="selectQnaCnt" resultType="kr.co.winnticket.community.qna.dto.QnaCntGetResDto">
        <![CDATA[
        Select
            Count(*) ALL_CNT,  -- 전체글 수
            Sum(Case
                    When a.IS_BLOCKED = 'false' And a.STATUS = 'PENDING' Then 1
                    Else 0
                End) PENDING_CNT,  -- 답변대기글 수
            Sum(Case
                    When a.IS_BLOCKED = 'false' And a.STATUS = 'ANSWERED' Then 1
                    Else 0
                End) ANSWERED_CNT,  -- 답변완료글 수
            Sum(Case When IS_BLOCKED = 'true' Then 1 Else 0 End) BLOCKED_CNT  -- 차단글 수
        From
            POSTS a
        Where 1 = 1
        And a.TYPE = 'QNA'
        ]]>
    </select>

    <!--
    - QNA 목록 Select
    -->
    <select id="selectQnaList" resultType="kr.co.winnticket.community.qna.dto.QnaListGetResDto">
        <![CDATA[
        Select
            a.ID,  -- 아이디
            a.TYPE,  -- 타입
            a.STATUS,  -- 상태
            a.TITLE,  -- 제목
            a.AUTHOR_NAME,  -- 작성자
            a.CREATED_AT,  -- 작성일자
            a.VIEWS,  -- 조회수
            a.IS_ACTIVE  -- 활성화여부
        FROM
            POSTS a
        Where 1 = 1
        And a.TYPE = 'QNA'
        And Upper(a.TITLE) Like '%' || Upper(#{title}) || '%'
        And Date(a.CREATED_AT) Between #{begDate} And #{endDate}
        And (#{staus} = 'ALL'
        Or (#{status} = 'BLOCKED'
        And Exists(
            Select 1
            From
                POSTS
            Where 1 = 1
            And IS_BLOCKED = 'true'
        ))
        Or a.STATUS = #{status})
        Order By
            Date(a.CREATED_AT) Desc
        ]]>
    </select>
</mapper>